{% extends "my_app/base.html" %}

{% block title %}{{ item.name }}{% endblock %}

{% block content %}
    <div class="cart-container">
        <h2>Ваша корзина</h2>
        {% if cart_items %}
            <table class="cart-table">
                <thead>
                    <tr>
                        <th>Товар</th>
                        <th>Количество</th>
                        <th>Цена</th>
                        <th>Сумма</th>
                    </tr>
                </thead>
                <tbody>
                    {% for item in cart_items %}
                    <tr id="item-row-{{ item.item.id }}" class="item-row">
                        <td data-label="Товар">{{ item.item.name }}</td>
                        <td data-label="Количество">{{ item.quantity }}</td>
                        <td data-label="Цена">{{ item.item.price }}</td>
                        <td data-label="Общая сумма">{{ item.get_total_price }}</td>
                        <td>
                            <div class="quantity-control">
                                <button type="button"
                                        class="btn-qty ajax-remove-btn"
                                        data-url="{% url 'cart_remove_ajax' item.item.id %}"
                                        data-item-id="{{ item.item.id }}">
                                -</button>

                                <span id="item-qty-{{ item.item.id }}">{{ item.quantity }}</span>

                                <button type="button" class="btn-qty ajax-add-btn"
                                        data-url="{% url 'add_to_cart_ajax' item.item.id %}"
                                        data-item-id="{{ item.item.id }}"
                                        {% if item.quantity >= item.item.stock %}disabled{% endif %}>
                                +</button>
                            </div>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>

            <div class="cart-total">
                Итого: <span id="cart-total-price">{{ total_price }}</span> моры
            </div>
            <div id="checkout-section">
                <a href="{% url 'order_create' %}"><button type="button" class="button cart_order_btn">Оформить заказ</button></a>
            </div>
            <div id="empty-cart-message" {% if cart_items %}style="display: none;"{% endif %}>
                <p>Ваш инвентарь пуст.</p>
                <a href="{% url 'item_list' %}"><button type="button" class="button">Вернуться в лавку</button></a>
            </div>
        {% else %}
            <p>Ваша корзина пока пуста.</p>
            <a href="{% url 'item_list' %}" class="cart-button" style="display: inline-block; margin-top: 20px; text-decoration: none;">
                <button type="button" class="button">Продолжить покупки</button>
            </a>
        {% endif %}
    </div>
{% endblock %}